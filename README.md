# Firdusi Food Ordering App

Кроссплатформенное приложение на Flutter для Android и iOS, предназначенное для ресторана «Фирдуоси». Реализация покрывает основные пользовательские сценарии (меню, фильтрация блюд, корзина, доставка/самовывоз, способы оплаты, количество приборов) и административную панель с возможностью просмотра и обновления статуса заказов.

## Основные возможности

- **Главный экран меню**
  - карточки блюд с изображением, описанием, ценой, весом и кнопками добавления/изменения количества;
  - фильтрация по категориям;
  - плашка со статусом активного заказа пользователя.
- **Корзина**
  - управление количеством блюд, выбор режима самовывоза или доставки, ввод адреса и телефона, контроль числа приборов;
  - выбор способа оплаты (наличные, карта курьеру, онлайн);
  - итоговая стоимость и оформление заказа.
- **Авторизация и профиль**
  - вход по SMS-коду: пользователь вводит номер телефона и подтверждает одноразовый код, который отправляется через `SmsService`;
  - сохранение имени, телефона, базового адреса и количества приборов между перезапусками с помощью `SharedPreferences`.
- **Административный интерфейс**
  - вход с логином `admin` и паролем `1234`;
  - просмотр списка заказов и изменение статуса (ожидание, принят, готовится, в доставке, готов, отменён).
- **Хранилище**
  - данные профиля, корзины, выбранных настроек и заказов сохраняются локально, имитируется работа с MySQL через интерфейс `BackendService`.

## Стек

- Flutter 3 (Material 3, адаптивные гриды и обновлённые стили)
- Provider для управления состоянием
- Shared Preferences для локального хранения
- Intl для форматирования дат

## Подготовка проекта

1. [Установите Flutter](https://docs.flutter.dev/get-started/install) версии 3.3 или выше.
2. Включите поддержку веб-платформы (выполняется один раз для вашей установки Flutter):

   ```bash
   flutter config --enable-web
   ```

3. Сгенерируйте служебные папки платформ (включая веб):

   ```bash
   flutter create . --platforms=android,ios,web
   ```

4. Убедитесь, что устройство Microsoft Edge обнаружено:

   ```bash
   flutter devices
   ```

5. В корне репозитория выполните:

   ```bash
   flutter pub get
   ```

6. Запустите приложение:

   ```bash
   flutter run
   ```

   - Чтобы открыть приложение непосредственно в Microsoft Edge на Windows, выполните команду `flutter run -d edge`, которая выберет браузер Edge в качестве целевого устройства. Перед запуском убедитесь, что Microsoft Edge установлен и отображается в списке `flutter devices`.

7. Для проверки продакшен-сборки можно использовать веб-бандл:

   ```bash
   flutter build web
   ```

   После сборки откройте файл `build/web/index.html` в Microsoft Edge (например, двойным кликом или через контекстное меню «Открыть с помощью»), чтобы убедиться, что приложение корректно работает в режиме веб-публикации.

### Требования и советы по устранению ошибок

- Для запуска в Edge необходим Windows 10/11 с установленным Microsoft Edge (Chromium). На других ОС используйте Chrome или другой поддерживаемый браузер (`flutter run -d chrome`).
- Если команда `flutter devices` не показывает Edge, запустите Edge хотя бы один раз, обновите его до последней версии и повторно выполните `flutter doctor --verbose`, чтобы убедиться, что драйвер WebView2 установлен.
- При ошибке «Unable to find any web devices» проверьте, что выполнены шаги `flutter config --enable-web` и `flutter create . --platforms web`, затем перезапустите терминал или командную строку.
- При проблемах со сборкой очистите кеш (`flutter clean`), установите зависимости (`flutter pub get`) и повторите `flutter build web`.

## Интеграция с MySQL (beget.com)

По умолчанию используется `MockBackendService`, поставляющий тестовые данные. Для подключения к реальной базе MySQL на beget.com:

1. Реализуйте REST API (например, на PHP) для эндпоинтов:
   - `GET /categories`
   - `GET /dishes`
   - `POST /orders`
   - `PATCH /orders/{id}`
2. Реализуйте класс `PhpBackendService` в `lib/services/backend_service.dart`, отправляющий HTTP-запросы к вашему API и возвращающий реальные модели.
3. Передайте экземпляр `PhpBackendService` в `AppState` (например, в `main.dart`).

## SMS-аутентификация

По умолчанию используется мок-реализация `MockSmsService`, которая логирует коды в консоль для локального тестирования. Чтобы
подключить реальную SMS-шлюз на стороне beget.com:

1. Реализуйте REST API, который принимает номер телефона и отправляет SMS с кодом подтверждения, а затем проверяет введённый
   код.
2. Воспользуйтесь шаблоном `ExternalSmsService` из `lib/services/sms_service.dart` — в нём уже оставлен закомментированный API
   ключ `457A5DBA-D814-BC10-DDD7-645DC659658E`. Перенесите ключ в переменную окружения или защищённое хранилище и добавьте
   фактические HTTP-запросы к вашему API.
3. Передайте экземпляр `ExternalSmsService` в `AppState` (аналогично бэкенду), чтобы запросы отправлялись в рабочий шлюз.

## Структура

- `lib/data/models` — модели данных (блюда, категории, заказы, профиль)
- `lib/providers` — управление состоянием приложения
- `lib/screens` — экраны (меню, корзина, профиль, админка)
- `lib/widgets` — переиспользуемые виджеты
- `lib/services` — абстракция и мок-сервис для бэкенда

## Дальнейшее развитие

- Подключить реальные изображения и меню из MySQL.
- Добавить карту и работу с геолокацией.
- Расширить админ-панель (история заказов, аналитика).
- Настроить push-уведомления об изменении статуса.

## Публикация на GitHub

Чтобы привязать локальный проект к удалённому репозиторию и выложить код на GitHub:

1. Создайте пустой репозиторий на GitHub (например, `https://github.com/never3d22/FirdusiAPP`).
2. В корне проекта выполните:

   ```bash
   git remote add origin https://github.com/never3d22/FirdusiAPP
   git branch -M main
   git push -u origin main
   ```

   Если вы работаете в другой ветке, сначала переименуйте её в `main` командой
   `git branch -M main`, а затем выполняйте `git push -u origin main`. Так GitHub
   распознает её как основную.
3. Для публикации последующих изменений используйте `git push`.

> **Примечание.** Если при выполнении `git push` появится ошибка вида `CONNECT tunnel failed, response 403`, это означает, что
> среда не может установить защищённое соединение с GitHub (часто из-за ограничений сетевого окружения). Выполните команду на
> своей машине с доступом к интернету или настройте необходимые прокси/учётные данные.

### Проверка, что вы находитесь в Git-репозитории

Иногда после распаковки архива или копирования файлов в новую папку команды Git выдают сообщение `fatal: not a git repository`.
Это означает, что в текущем каталоге нет скрытой папки `.git`, где хранится история коммитов. Чтобы убедиться, что вы работаете
в правильном месте:

1. Выполните `ls -a` (или `dir /a` в Windows PowerShell) и убедитесь, что в списке есть каталог `.git`.
2. Если `.git` отсутствует, перейдите (`cd`) в папку, где находится репозиторий, или инициализируйте его заново командой `git init`.
3. После этого повторите шаги из раздела «Публикация на GitHub», чтобы добавить `origin` и выполнить `git push`.

Так вы избежите ситуации, когда команды запускаются вне репозитория и изменения не попадают в GitHub.

